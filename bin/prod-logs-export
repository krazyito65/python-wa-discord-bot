#!/bin/bash
# Export recent production logs to a text file for editing/analysis
# Usage: bin/prod-logs-export [hours] [output-file]

set -euo pipefail

HOURS=${1:-24}
OUTPUT_FILE=${2:-"production-logs-$(date +%Y%m%d-%H%M%S).txt"}

echo "📤 Exporting production logs to text file..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "⏰ Time range: Last ${HOURS} hours"
echo "📁 Output file: ${OUTPUT_FILE}"
echo ""

# Export from journalctl (more complete data)
echo "# WeakAuras Production Logs Export" > "${OUTPUT_FILE}"
echo "# Generated: $(date)" >> "${OUTPUT_FILE}"
echo "# Time range: Last ${HOURS} hours" >> "${OUTPUT_FILE}"
echo "# Services: weakauras-bot, weakauras-django, nginx" >> "${OUTPUT_FILE}"
echo "" >> "${OUTPUT_FILE}"

echo "=== DISCORD BOT LOGS ===" >> "${OUTPUT_FILE}"
sudo journalctl -u weakauras-bot --since "${HOURS} hours ago" --no-pager >> "${OUTPUT_FILE}"

echo "" >> "${OUTPUT_FILE}"
echo "=== DJANGO WEB LOGS ===" >> "${OUTPUT_FILE}"
sudo journalctl -u weakauras-django --since "${HOURS} hours ago" --no-pager >> "${OUTPUT_FILE}"

echo "" >> "${OUTPUT_FILE}"
echo "=== NGINX LOGS ===" >> "${OUTPUT_FILE}"
sudo journalctl -u nginx --since "${HOURS} hours ago" --no-pager >> "${OUTPUT_FILE}"

echo "✅ Logs exported successfully!"
echo "📄 File: ${OUTPUT_FILE}"
echo "📊 Size: $(du -h "${OUTPUT_FILE}" | cut -f1)"
echo ""
echo "💡 Tips:"
echo "  • Open with: nano ${OUTPUT_FILE}"
echo "  • Search with: grep 'ERROR' ${OUTPUT_FILE}"
echo "  • Copy with: scp user@server:$(pwd)/${OUTPUT_FILE} ."
